# 4.6 微众银行一面

**消息下发平台 怎么做渠道的隔离 **
我们接收到请求了以后，会把消息写到Kafka（消息队列），目前我们的做法是给每个渠道的每种类型都使用不同的消费者（group），那自然他们的消费就不会互相影响。

比如，发短信有1000W人，也不会影响到发push通知的2000W人。
**消息丢失，消息重复消费怎么解决 **
消息丢失有两方面：1、生产者丢失 2、消费者丢失
生产者丢失可以通过**配置参数**以及**失败回调**进行解决，而消费者丢失我们可以实现在消费端**实现至少一次语义**（大致的思路就是关闭自动提交offset，自己手动提交，并且确保提交的offset一定是最小的）
**消息下发失败怎么办（重试），那如果一直失败呢 **
消息下发失败目前我们是不做策略的，最多会告警让业务方自身通过平台的能力再去重试。

而问题本身，也可以提出重试的技术方案。
1、首先确保消息推送平台**本身是没有挂的**（只是某个渠道或者某个中间件短时间出了异常导致下发失败了）
2、而重试就可以把消息写到其他的MQ或者调用其他的程序进行下发兜底补充（这块需要关联业务来聊，因为很多消息的下发是有时效性的，**并且必须确保是不是真的下发失败，不然下发多了消息比丢了消息这个问题是会更严重的**）
**一直失败上游业务方会收到什么通知？ 你这是做业务告警的系统，告警消息发送失败不是业务有损的吗，这块怎么解决**

一直失败上游业务方会收到什么通知？可以有下发失败的通知，告知该模板的消息下发失败了（**一般是整个模板的消息失败，而不是某条失败**），由于消息内容我们在系统里都可以查看，所以这块直接告知业务即可。

告警消息发送失败不是业务有损的吗，这块怎么解决？方案：可以把某些模板确认为是**核心消息**，平台可针对这类的消息做重点的关注和处理（回到上面的重试方案上）。

**经验值：消息推送平台作为一个下发消息的平台，绝大数下发失败都跟接收者本身有关（push可能是手机的各种权限，短信可能是已停号，邮件可能是业务没提供正确的邮箱地址，IM可能是用户已经关闭了提醒等等）**

**消息重发是平台做还是业务方做？ **
业务方做，平台不做重发的功能，平台在后台有提供圈选一批人再去下发消息的功能。

若有收获，就点个赞吧

 


> 原文: <https://www.yuque.com/u37247843/dg9569/oiwqg9w6eg0m89wx>